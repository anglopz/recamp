<% layout('layout/boilerplate') %>

    <style>
        .edit-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin: 1rem 0;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .image-preview-container {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 1rem;
            background: #fafafa;
        }

        .current-image {
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .current-image:hover {
            transform: scale(1.05);
            border-color: #0d6efd;
        }

        .delete-checkbox:checked+label {
            color: #dc3545;
            font-weight: bold;
        }

        .file-upload-area {
            border: 2px dashed #0dcaf0;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background: #f8fdff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            background: #e6f7ff;
            border-color: #0d6efd;
        }

        /* Mejoras para móviles */
        @media (max-width: 768px) {
            .file-upload-area {
                padding: 1.5rem;
                min-height: 120px;
            }

            /* Mejorar el área táctil */
            .btn-lg {
                padding: 1rem 1.5rem;
                font-size: 1.1rem;
                min-height: 60px;
                /* Tamaño mínimo para touch */
            }
        }

        /* Asegurar que los botones sean fáciles de tocar en móviles */
        @media (max-width: 576px) {
            .btn {
                min-height: 44px;
                /* Tamaño mínimo recomendado para touch */
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
    </style>

    <div class="edit-container">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold text-primary">
                <i class="bi bi-pencil-square"></i> Edit Campground
            </h1>
            <p class="lead text-muted">Update your campground information</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <form action="/campgrounds/<%=campground._id%>?_method=PUT" method="POST" novalidate
                    class="validated-form" enctype="multipart/form-data">

                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h4 class="mb-4 text-primary">
                            <i class="bi bi-info-circle"></i> Basic Information
                        </h4>

                        <div class="mb-3">
                            <label class="form-label fw-bold" for="title">
                                <i class="bi bi-card-heading"></i> Title
                            </label>
                            <input class="form-control form-control-lg" type="text" id="title" name="campground[title]"
                                value="<%=campground.title %>" required placeholder="Enter campground title">
                            <div class="valid-feedback">
                                <i class="bi bi-check-circle-fill"></i> Looks good!
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold" for="location">
                                <i class="bi bi-geo-alt"></i> Location
                            </label>
                            <input class="form-control" type="text" id="location" name="campground[location]"
                                value="<%=campground.location %>" required placeholder="Enter campground location">
                            <div class="valid-feedback">
                                <i class="bi bi-check-circle-fill"></i> Valid location!
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold" for="description">
                                <i class="bi bi-text-paragraph"></i> Description
                            </label>
                            <textarea class="form-control" id="description" name="campground[description]" rows="5"
                                required
                                placeholder="Describe your campground..."><%=campground.description %></textarea>
                            <div class="valid-feedback">
                                <i class="bi bi-check-circle-fill"></i> Great description!
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Section -->
                    <div class="form-section">
                        <h4 class="mb-4 text-success">
                            <i class="bi bi-currency-euro"></i> Pricing
                        </h4>

                        <div class="mb-3">
                            <label class="form-label fw-bold" for="price">Price per Night</label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text bg-success text-white">
                                    <i class="bi bi-currency-euro"></i>
                                </span>
                                <input type="number" class="form-control" id="price" placeholder="0.00" step="0.01"
                                    min="0" name="campground[price]" value="<%=campground.price %>" required>
                                <span class="input-group-text">/ night</span>
                            </div>
                            <div class="valid-feedback">
                                <i class="bi bi-check-circle-fill"></i> Perfect price!
                            </div>
                        </div>
                    </div>

                    <!-- Images Management Section -->
                    <div class="form-section">
                        <h4 class="mb-4 text-info">
                            <i class="bi bi-images"></i> Images Management
                        </h4>

                        <!-- Add New Images -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Add New Images</label>

                            <!-- Desktop version -->
                            <div class="file-upload-area d-none d-md-block"
                                onclick="document.getElementById('simpleFile').click()">
                                <i class="bi bi-cloud-arrow-up display-4 text-info mb-3"></i>
                                <h5>Click to upload new images</h5>
                                <p class="text-muted">Select multiple images to add to your campground</p>
                                <span id="simpleFileName" class="badge bg-info fs-6 mt-2"></span>
                            </div>

                            <!-- Mobile version -->
                            <div class="d-md-none">
                                <button type="button" class="btn btn-info btn-lg w-100 py-3"
                                    onclick="document.getElementById('simpleFile').click()">
                                    <i class="bi bi-cloud-arrow-up-fill me-2"></i>Add New Images
                                </button>
                                <p class="text-muted text-center mt-2 small">
                                    <i class="bi bi-info-circle"></i> You can select multiple images
                                </p>
                            </div>

                            <input type="file" id="simpleFile" class="d-none" accept="image/*" name="images" multiple
                                onchange="updateFileName(this)" capture="environment">
                        </div>

                        <!-- Current Images -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Current Images</label>
                            <% if (campground.images && campground.images.length> 0) { %>
                                <div class="row g-3">
                                    <% campground.images.forEach(function(img, i) { %>
                                        <div class="col-md-6 col-lg-4">
                                            <div class="card border-0 shadow-sm">
                                                <div class="position-relative">
                                                    <img src="<%= img.thumbnail || img.url %>"
                                                        class="card-img-top current-image rounded"
                                                        alt="Campground image"
                                                        style="height: 150px; object-fit: cover;">
                                                    <div class="position-absolute top-0 end-0 m-2">
                                                        <div class="form-check form-switch">
                                                            <input class="form-check-input delete-checkbox"
                                                                type="checkbox" id="image-<%= i %>"
                                                                name="deleteImages[]" value="<%= img.filename %>">
                                                            <label class="form-check-label" for="image-<%= i %>">
                                                                <i class="bi bi-trash"></i>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-body text-center">
                                                    <small class="text-muted">Image <%= i + 1 %></small>
                                                </div>
                                            </div>
                                        </div>
                                        <% }) %>
                                </div>
                                <% } else { %>
                                    <div class="alert alert-info text-center py-4">
                                        <i class="bi bi-image display-4"></i>
                                        <h5 class="mt-3">No images available</h5>
                                        <p class="mb-0">Upload some images to make your campground stand out!</p>
                                    </div>
                                    <% } %>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a href="/campgrounds/<%= campground._id%>" class="btn btn-outline-secondary btn-lg me-md-2">
                            <i class="bi bi-arrow-left"></i> Back to Campground
                        </a>
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle-fill"></i> Update Campground
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function updateFileName(input) {
            const fileNameSpan = document.getElementById('simpleFileName');
            if (input.files.length > 0) {
                const fileNames = Array.from(input.files).map(f => f.name).join(', ');
                fileNameSpan.textContent = `${input.files.length} image(s) selected: ${fileNames}`;
                fileNameSpan.className = 'badge bg-success fs-6 mt-2';

                // Feedback táctil para móviles
                if ('vibrate' in navigator) {
                    navigator.vibrate(100);
                }
            } else {
                fileNameSpan.textContent = '';
            }
        }

        // Add hover effects to delete checkboxes
        document.querySelectorAll('.delete-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                const card = this.closest('.card');
                if (this.checked) {
                    card.style.opacity = '0.6';
                    card.style.border = '2px solid #dc3545';
                } else {
                    card.style.opacity = '1';
                    card.style.border = '';
                }
            });
        });

        // Prevenir problemas de zoom en iOS
        document.addEventListener('touchstart', function (e) {
            const fileInput = document.getElementById('simpleFile');
            if (e.target === fileInput) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>